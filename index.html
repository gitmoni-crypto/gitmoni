<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GitMoni</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Extra styles for homepage additions */
    .home-section { margin: 20px 0; }
    .home-section h2 { margin-top: 0; }
    .pill-link {
      display: inline-block;
      background: var(--card);
      border: 1px solid var(--accent);
      border-radius: 999px;
      padding: 6px 12px;
      margin: 4px 6px 12px 0;
      text-decoration: none;
      color: var(--fg);
      font-size: 13px;
    }
    .pill-link:hover { background: var(--accent); color: #fff; }
  </style>
</head>
<body>
  <header>
    <h1>ğŸŒ GitMoni</h1>
    <span class="muted">A GitHub-native experiment in social currency</span>
  </header>

  <main class="grid">
    <div class="card span-12 home-section">
      <h2>ğŸ’¸ What is MONI?</h2>
      <p>MONI is a mock currency granted once per GitHub user when they star the <a href="https://github.com/gitmoni-crypto/gitmoni" target="_blank">GitMoni repo</a>. The reward decreases with rank (1/n decay), incentivizing early adoption and capping total supply.</p>
      <p>Each user gets: <code>G1 / rank</code> where <code>G1 = 1,618,033,989</code> (golden mean Ã— 10<sup>9</sup>).</p>
    </div>

    <div class="card span-6 home-section">
      <h2>ğŸª™ Your Balance</h2>
      <div class="row">
        <input id="ghuser" class="mono" placeholder="GitHub username" size="20" />
        <button id="check" class="btn">Check</button>
      </div>
      <div class="row small">
        <span class="pill" id="addr">addr: â€”</span>
        <span class="pill" id="bal">balance: â€”</span>
        <a id="toExplorer" class="pill-link" href="explorer.html">Explorer â†’</a>
      </div>
    </div>

    <div class="card span-6 home-section">
      <h2>ğŸ§¾ Quick Links</h2>
      <a class="pill-link" href="explorer.html">ğŸ” Explorer</a>
      <a class="pill-link" href="submit.html">âœï¸ Submit TX</a>
      <a class="pill-link" href="https://github.com/gitmoni-crypto/gitmoni" target="_blank">ğŸ“¦ GitHub Repo</a>
      <a class="pill-link" href="data/balances.json" target="_blank">ğŸ’° balances.json</a>
    </div>

    <div class="card span-12 home-section">
      <h2>ğŸ“š How It Works</h2>
      <ul>
        <li>MONI grants are triggered by GitHub stars â€” one per user, automatically recorded as a TX.</li>
        <li>All TXs are JSON files in the <code>transactions</code> branch. Merges are validated via GitHub Actions.</li>
        <li>Only the GitHub user matching the <code>from</code> address may submit a transaction from it.</li>
        <li>Indexes are rebuilt every 10 minutes and published to GitHub Pages.</li>
      </ul>
    </div>
  </main>

  <footer style="text-align:center; padding:16px; font-size:12px; color:var(--muted);">
    GitMoni â€” Powered by GitHub. All transactions are public and auditable.
  </footer>

  <script type="module">
    const $ = s => document.querySelector(s);
    const addrOf = u => `gh:${(u || '').trim()}`;
    const fmt = n => (n ?? 0).toLocaleString(undefined, { maximumFractionDigits: 8 });
    let BAL = null;

    async function loadBalances() {
      if (BAL) return BAL;
      try {
        const r = await fetch('data/balances.json', { cache: 'no-store' });
        BAL = await r.json();
      } catch {
        BAL = {};
      }
      return BAL;
    }

    async function checkBalance() {
      const u = $('#ghuser').value.trim();
      const a = addrOf(u);
      $('#addr').textContent = `addr: ${a || 'â€”'}`;
      $('#toExplorer').href = u ? `explorer.html?addr=${encodeURIComponent(a)}` : 'explorer.html';
      const b = await loadBalances();
      $('#bal').textContent = `balance: ${fmt(b[a] || 0)}`;
    }

    $('#check').addEventListener('click', checkBalance);
    $('#ghuser').addEventListener('keydown', e => { if (e.key === 'Enter') checkBalance(); });
  </script>
</body>
</html>
