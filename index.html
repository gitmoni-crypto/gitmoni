<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GitMoni</title>
  <link rel="stylesheet" href="styles.css" />
  <style></style>
</head>
<body>
  <header>
    <h1>üåê GitMoni</h1>
    <p>A crypto-inspired experiment built entirely on GitHub.</p>
  </header>

  <nav>
    <a class="btn" href="explorer.html">üîé Explorer</a>
    <a class="btn" href="submit.html">‚úçÔ∏è Submit Transaction</a>
    <a class="btn" href="https://github.com/gitmoni-crypto/gitmoni" target="_blank">üì¶ GitHub Repo</a>
  </nav>

  <main>
    <section>
      <h2>Check your balance</h2>
      <p>Enter your GitHub username to see your MONI balance:</p>
      <input id="ghuser" class="mono" placeholder="your GitHub username" />
      <button id="check" class="btn">Check</button>
      <div style="margin-top:10px;">
        <span class="pill" id="addr">addr: ‚Äî</span>
        <span class="pill" id="bal">balance: ‚Äî</span>
      </div>
      <p style="margin-top:8px;">
        Tip: your address is <code>gh:USERNAME</code>. Balances load from <code>data/balances.json</code>.
      </p>
    </section>

    <section>
      <h2>What is MONI?</h2>
      <p>
        MONI is a community currency distributed through GitHub stars ‚≠ê. 
        Each GitHub account can star the repo once and receives a one-time faucet grant.
      </p>
    </section>

    <section>
      <h2>How distribution works</h2>
      <ul>
        <li>The <strong>1st stargazer</strong> receives ~1.6 billion MONI.</li>
        <li>The <strong>n-th stargazer</strong> receives <code>g1 / n</code>.</li>
        <li>Total free supply converges slowly (~40 billion MONI max).</li>
        <li>After the faucet, you can only earn MONI via transfers.</li>
      </ul>
    </section>

    <section>
      <h2>The Ledger</h2>
      <p>
        All transactions are public JSON files in the
        <code>transactions</code> branch. The Explorer provides fast indexes
        (<code>balances.json</code>, <code>txmeta.json</code>) for quick lookups.
      </p>
      <p>
        Every transaction is validated by GitHub Actions. The <code>from</code> 
        field must match the PR actor‚Äôs GitHub login.
      </p>
    </section>

    <section>
      <h2>Get Started</h2>
      <ol>
        <li>‚≠ê Star the <a href="https://github.com/gitmoni-crypto/gitmoni" target="_blank">GitMoni repo</a>.</li>
        <li>Wait for the faucet (runs every 10 min) to grant your MONI.</li>
        <li>Check your balance above or in the <a href="explorer.html">Explorer</a>.</li>
        <li>Submit transfers with <a href="submit.html">Submit Transaction</a>.</li>
      </ol>
    </section>
  </main>

  <footer>
    <p>
      Built with ‚ù§Ô∏è on GitHub Pages ‚Ä¢ 
      Source: <a href="https://github.com/gitmoni-crypto/gitmoni">gitmoni-crypto/gitmoni</a>
    </p>
  </footer>

  <script type="module">
    const $ = (s)=>document.querySelector(s);
    const ghAddr = (u)=> `gh:${(u||'').trim()}`;
    const fmt = (n)=> (n??0).toLocaleString(undefined, { maximumFractionDigits: 8 });

    let BAL = null;
    async function loadBalances() {
      if (BAL) return BAL;
      try {
        const r = await fetch('data/balances.json', { cache: 'no-store' });
        BAL = await r.json();
      } catch {
        BAL = {};
      }
      return BAL;
    }

    async function showBalance() {
      const user = $('#ghuser').value.trim();
      const addr = ghAddr(user);
      $('#addr').textContent = `addr: ${addr || '‚Äî'}`;
      if (!user) { $('#bal').textContent = 'balance: ‚Äî'; return; }

      const bal = await loadBalances();
      const v = bal[addr] ?? 0;
      $('#bal').textContent = `balance: ${fmt(v)}`;
    }

    $('#check').addEventListener('click', showBalance);
    $('#ghuser').addEventListener('keydown', (e)=> { if (e.key === 'Enter') showBalance(); });

    // Prefill from ?user= param
    const params = new URLSearchParams(location.search);
    const pre = params.get('user') || (params.get('addr') || '').replace(/^gh:/,'');
    if (pre) { $('#ghuser').value = pre; showBalance(); }
  </script>
</body>
</html>
