<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GitMoni</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <h1>GitMoni</h1>
    <span class="muted">A GitHub-native experiment in social currency</span>
  </header>

  <nav style="display: flex; gap: 12px; padding: 16px; border-bottom: 1px solid #13202e;">
    <a class="btn" href="index.html">🏠 Home</a>
    <a class="btn" href="explorer.html">🔍 Explorer</a>
    <a class="btn" href="submit.html">✍️ Submit</a>
    <a class="btn" href="https://github.com/gitmoni-crypto/gitmoni" target="_blank">📦 GitHub</a>
  </nav>

  <main class="grid">
    <div class="card span-12">
      <h2>💸 What is MONI?</h2>
      <p>MONI is a mock currency granted once per GitHub user when they star the <a href="https://github.com/gitmoni-crypto/gitmoni" target="_blank">GitMoni repo</a>.</p>
      <ul>
        <li><strong>1st stargazer</strong> gets ~1.6B MONI</li>
        <li>Each user gets <code>G1 / rank</code>, where <code>G1 = 1,618,033,989</code></li>
        <li>Rank is based on star order, ensuring harmonic decay and capped supply</li>
      </ul>
    </div>

    <div class="card span-6">
      <h2>🧾 Your Balance</h2>
      <div class="row">
        <input id="ghuser" class="mono" placeholder="GitHub username" size="20" />
        <button id="check" class="btn">Check</button>
      </div>
      <div class="row small">
        <span class="pill" id="addr">addr: —</span>
        <span class="pill" id="bal">balance: —</span>
        <a id="toExplorer" class="pill" href="explorer.html">Explorer →</a>
      </div>
    </div>

    <div class="card span-6">
      <h2>⚙️ System</h2>
      <ul>
        <li>All TXs are JSON files in the <code>transactions</code> branch</li>
        <li>Each TX is PR’d and validated by GitHub Actions</li>
        <li>Only the GitHub user in the <code>from</code> field can submit the TX</li>
        <li>Explorer reads <code>balances.json</code>, <code>index.json</code>, and <code>txmeta.json</code></li>
      </ul>
    </div>

    <div class="card span-12">
      <h2>🚀 How to Use</h2>
      <ol>
        <li>Star the <a href="https://github.com/gitmoni-crypto/gitmoni" target="_blank">repo</a></li>
        <li>Wait for the faucet job (~10 min)</li>
        <li>Check balance above or in <a href="explorer.html">Explorer</a></li>
        <li>Submit transfers with <a href="submit.html">Submit</a></li>
      </ol>
    </div>
  </main>

  <footer style="text-align:center; padding:16px; font-size:12px; color:var(--muted);">
    GitMoni — Powered by GitHub. All transactions are public and auditable.
  </footer>

  <script type="module">
    const $ = s => document.querySelector(s);
    const addrOf = u => `gh:${(u || '').trim()}`;
    const fmt = n => (n ?? 0).toLocaleString(undefined, { maximumFractionDigits: 8 });
    let BAL = null;

    async function loadBalances() {
      if (BAL) return BAL;
      try {
        const r = await fetch('data/balances.json', { cache: 'no-store' });
        BAL = await r.json();
      } catch {
        BAL = {};
      }
      return BAL;
    }

    async function checkBalance() {
      const u = $('#ghuser').value.trim();
      const a = addrOf(u);
      $('#addr').textContent = `addr: ${a || '—'}`;
      $('#toExplorer').href = u ? `explorer.html?addr=${encodeURIComponent(a)}` : 'explorer.html';
      const b = await loadBalances();
      $('#bal').textContent = `balance: ${fmt(b[a] || 0)}`;
    }

    $('#check').addEventListener('click', checkBalance);
    $('#ghuser').addEventListener('keydown', e => { if (e.key === 'Enter') checkBalance(); });
  </script>
</body>
</html>
