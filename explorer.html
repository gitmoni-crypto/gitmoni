<!DOCTYPE html>
<html>
<head>
  <title>GitMoni Explorer</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>GitMoni Verified Balances</h1>
  <pre id="balances"></pre>

  <script>
    async function sha256(str) {
      const enc = new TextEncoder().encode(str);
      const hash = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function verifyProof(leaf, proof, root) {
      let hash = leaf;
      for (const step of proof) {
        hash = step.direction === 'left'
          ? await sha256(step.hash + hash)
          : await sha256(hash + step.hash);
      }
      return hash === root;
    }

    async function updateBalances() {
      const balances = await fetch('data/balances.json').then(r => r.json());
      const txs = await fetch('data/txs.json').then(r => r.json());
      const proofs = await fetch('data/proofs.json').then(r => r.json());
      const merkleRoot = await fetch('merkle-root.txt').then(r => r.text());

      for (let i = 0; i < txs.length; i++) {
        const tx = txs[i];
        const leaf = await sha256(JSON.stringify(tx));
        const proof = proofs[i];

        if (await verifyProof(leaf, proof, merkleRoot.trim())) {
          balances[tx.from] = (balances[tx.from] || 0) - tx.amount;
          balances[tx.to] = (balances[tx.to] || 0) + tx.amount;
        }
      }

      document.getElementById('balances').textContent = JSON.stringify(balances, null, 2);
    }

    updateBalances();
  </script>
</body>
</html>
